{% extends "base.html" %}

{% block title %}Grow Calculator - Fruit Value Calculator for Roblox Grow a Garden{% endblock %}

{% block content %}
 <!-- Hero Section -->
 <div class="p-4 flex flex-col items-center mt-8">
     <h1 class="text-4xl font-bold text-center flex items-center justify-center mb-2">
         <img src="/static/img/title.png" alt="Grow a Garden Calculator" class="h-16">
     </h1>
     <div class="text-center">
         <img src="/static/img/subtitletext.png" alt="Calculate fruit values for Roblox Grow a Garden!" class="h-4">
     </div>
 </div>

<!-- Main Calculator Section -->
<main class="w-full max-w-6xl flex flex-col gap-6 mt-6">
    <!-- Plant Selection Grid -->
    <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
        <input type="text" id="plant-search" placeholder="Search crops..." 
               class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-green-500" value="">
        <div class="overflow-y-auto max-h-[300px] custom-scrollbar border border-gray-700 rounded-lg mt-4 notranslate" translate="no">
            <div class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-8 gap-2 p-2" id="plant-grid">
                                 {% for plant in plants %}
                 <button class="p-2 border rounded text-center transition duration-200 focus:outline-none bg-gray-700 hover:bg-green-900 border-gray-600" 
                         data-plant="{{ plant.name }}"
                         title="{{ plant.name }}
 💰 Value: {{ plant.base_price }} | ⚖️ Weight: {{ plant.base_weight }}kg" 
                         aria-pressed="false">
                                           <div class="w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                          <img src="/static/img/placeholder.png" alt="Placeholder" class="w-full h-full object-contain crop-placeholder">
                          <img src="/static/img/crop-{{ plant.name.lower().replace(' ', '-') }}.webp" 
                               alt="{{ plant.name }}" 
                               class="w-full h-full object-contain crop-image"
                               style="display: none;"
                               onerror="this.style.display='none'; this.previousElementSibling.style.display='block';"
                               onload="this.style.display='block'; this.previousElementSibling.style.display='none';">
                      </div>
                     <p class="text-sm font-semibold text-white truncate">{{ plant.name }}</p>
                 </button>
                 {% endfor %}
            </div>
        </div>
    </div>

    <!-- Mutations Section -->
    <div class="bg-gray-800 p-4 rounded-lg shadow-lg space-y-4">
        <!-- Growth Mutations -->
        <div class="bg-gray-800 p-4 rounded-lg shadow-md">
            <h3 class="text-base sm:text-lg font-semibold mb-3 text-gray-200 flex items-center">
                <img src="/static/img/Variant.png" alt="Variant Icon" class="w-5 h-5 mr-2">
                Variant Mutations
            </h3>
            <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-3">
                {% for variant in variants %}
                <label class="flex items-center gap-2 p-2 border rounded-md text-sm transition cursor-pointer {% if variant.name == 'Normal' %}bg-green-700/50 border-green-500 text-white{% else %}bg-gray-700/30 text-gray-300 hover:bg-green-800/40 hover:text-white{% endif %}">
                    <input type="radio" class="accent-green-500 w-4 h-4" name="variant" value="{{ variant.name }}" 
                           {% if variant.name == "Normal" %}checked{% endif %}>
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center w-full text-sm">
                        <span class="font-medium">{{ variant.name }}</span>
                        <span class="text-xs sm:text-sm opacity-80 whitespace-nowrap">(x{{ variant.multiplier }})</span>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>

        <!-- Environmental Mutations (including weather mutations) -->
        <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                         <h3 class="text-base sm:text-lg font-semibold mb-3 text-gray-200 flex items-center">
                 <img src="/static/img/normal.png" alt="Mutations Icon" class="w-5 h-5 mr-2">
                 Mutations
             </h3>
            <input type="text" id="mutation-search" placeholder="Search mutations..." 
                   class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-green-500 mb-4">
            <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-3 mutations-scrollable" style="max-height: calc(6 * 2.5rem + 1rem); overflow-y: auto; scrollbar-width: thin; scrollbar-color: #10b981 #2d3748;">
                {% for mutation in mutations %}
                <label class="flex items-center gap-2 p-2 border rounded-md text-sm transition cursor-pointer bg-gray-700/30 text-gray-300 hover:bg-green-800/40 hover:text-white">
                    <input type="checkbox" class="accent-green-500 w-4 h-4" data-mutation="{{ mutation.name }}">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center w-full text-sm">
                        <span class="font-medium">{{ mutation.name }}</span>
                        <span class="text-xs sm:text-sm opacity-80 whitespace-nowrap">(+{{ mutation.value_multi - 1 }})</span>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Calculator Section -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-green-400">Fruit Value Calculator</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 notranslate" translate="no">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm mb-1 text-gray-300 translate" translate="yes">Amount of Plants</label>
                                                 <input type="number" min="1" id="plant-amount" aria-label="Amount of Plants" 
                                class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-green-500" value="">
                    </div>
                    <div>
                        <label class="block text-sm mb-1 text-gray-300 translate" translate="yes">Total Weight (kg)</label>
                                                 <input type="text" id="plant-weight" aria-label="Crop weight in kilograms" 
                                class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-green-500" value="">
                        <div id="weight-range" class="text-xs text-gray-400 mt-1">
                            Expected: <span id="weight-min"></span> – <span id="weight-max"></span> kg
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div class="flex flex-col justify-center items-center text-center">
                                         <div class="w-20 h-20 mb-3 flex items-center justify-center" id="plant-emoji">
                         <img src="/static/img/placeholder.png" alt="Placeholder" class="w-full h-full object-contain" id="plant-placeholder">
                         <img src="" alt="" class="w-full h-full object-contain" id="plant-image" style="display: none;">
                     </div>
                    <div class="mb-2 text-lg font-semibold text-yellow-400" id="result-title"></div>
                                         <div class="text-green-400 font-bold text-3xl" id="result-value">
                         <div class="text-sm text-gray-300 mt-1" id="result-sheckles"></div>
                     </div>
                    
                    <!-- Total Value Display -->
                    <div id="total-value-section" class="mt-4 p-3 bg-purple-50/10 rounded-lg hidden">
                                                 <p class="text-sm text-purple-300 mb-1">Total Value (<span id="plant-count"></span> plants):</p>
                         <div class="text-3xl font-bold text-purple-400" id="total-value"></div>
                         <div class="text-xs text-purple-300" id="total-sheckles"></div>
                    </div>
                </div>
            </div>
            
            <!-- Calculation Summary -->
            <div class="mt-6 bg-gray-900 p-4 rounded-md notranslate" translate="no">
                <h4 class="text-md font-semibold text-yellow-300 mb-2 translate" translate="yes">Total Multiplier: <span class="text-blue-400" id="total-multiplier"></span></h4>
                <p class="text-sm text-gray-300 leading-snug">
                    <span class="text-yellow-200" id="mutation-breakdown"></span>
                </p>
                                 <p class="text-sm mt-2 text-gray-400" id="result-summary">
                     <img src="/static/img/currency.png" alt="Currency" class="w-4 h-4 inline-block mr-1"> <span class="text-green-300 font-semibold" id="plant-name"></span> weighing 
                     <span class="text-blue-300" id="weight-display"></span> kg, after 
                     <span class="text-purple-400" id="multiplier-display"></span> mutation, worth 
                     <span class="text-green-400" id="final-sheckles"></span> Sheckles.
                 </p>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4 mt-6 justify-center">
                <button class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 px-6 py-3 rounded-lg shadow-lg transition-all duration-200 text-white font-semibold transform hover:scale-105" id="share-result" aria-label="Share Calculation Result">
                    Share Results
                </button>
                <button class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded shadow transition text-white" id="clear-all" aria-label="Clear All Inputs">Clear All</button>
            </div>
        </div>
    </div>
</main>



<!-- Information Sections -->
<section class="w-full max-w-6xl mx-auto px-4 my-12 space-y-16 text-gray-300">
    <div class="text-center space-y-4">
        <h2 class="text-3xl font-bold text-white">What is Grow Calculator?</h2>
        <p class="max-w-3xl mx-auto text-gray-400">
            GrowCalculator is the most accurate and reliable tool available for players looking to calculate the value of over 176+ crops, including all known mutations, fruit weight, and bulk calculations with 96-100% accuracy.
        </p>
        <p class="max-w-3xl mx-auto text-gray-400">
            Our calculator takes into account advanced value metrics, including the fruit's weight (which scales quadratically for even greater impact), bulk quantity calculations for trading, and precise mutation effects. It's the perfect resource for casual farmers and serious traders alike, helping you make informed decisions in the fast-paced Grow A Garden marketplace.
        </p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 text-center">
        <div class="dark-card p-6">
            <h3 class="text-xl font-bold text-white mb-2">Complete Plant Database</h3>
            <p class="text-gray-400">Explore all 176 plants, from basic crops to rare divine fruits, using real in-game values for trustworthy results.</p>
        </div>
        <div class="dark-card p-6">
            <h3 class="text-xl font-bold text-white mb-2">Mutation Calculation Made Simple</h3>
            <p class="text-gray-400">Apply different mutations—Rainbow, Celestial, Shocked—and instantly see their impact on your crop's value.</p>
        </div>
        <div class="dark-card p-6">
            <h3 class="text-xl font-bold text-white mb-2">Crop Values You Can Trust</h3>
            <p class="text-gray-400">96-100% accurate results based on real game source code help you understand your crop's true worth.</p>
        </div>
    </div>
</section>

<!-- Formula Section -->
<section class="max-w-6xl px-8 py-10 bg-gray-800 rounded-xl text-white mx-auto">
    <h2 class="text-3xl md:text-4xl font-bold text-center text-green-400 mb-10">The Value Calculation Formula</h2>
    
    <div class="mb-6 p-6 rounded-lg bg-green-100/10 border border-green-300/30">
        <h3 class="text-xl font-semibold text-green-300 mb-2">Step 1: Calculate Mutation Multiplier</h3>
        <pre class="bg-white text-gray-900 p-4 rounded-md overflow-x-auto text-sm"><code>Mutation Multiplier = 1 + Σ(mutation.ValueMulti - 1)</code></pre>
        <p class="mt-2 text-sm text-gray-300">Calculate mutation effects additively. Each mutation contributes (ValueMulti - 1) to the total multiplier, starting from a base of 1.</p>
    </div>
    
    <div class="mb-6 p-6 rounded-lg bg-purple-100/10 border border-purple-300/30">
        <h3 class="text-xl font-semibold text-purple-300 mb-2">Step 2: Calculate Base Value</h3>
        <pre class="bg-white text-gray-900 p-4 rounded-md overflow-x-auto text-sm"><code>Base Value = Base Price × Mutation Multiplier × Variant Multiplier</code></pre>
        <p class="mt-2 text-sm text-gray-300">Combine the plant's base price with mutation and variant multipliers (Normal=1x, Silver=5x, Gold=20x, Rainbow=50x).</p>
    </div>
    
    <div class="mb-6 p-6 rounded-lg bg-blue-100/10 border border-blue-300/30">
        <h3 class="text-xl font-semibold text-blue-300 mb-2">Step 3: Apply Weight & Round</h3>
        <pre class="bg-white text-gray-900 p-4 rounded-md overflow-x-auto text-sm"><code>Final Price = Round(Base Value × (Weight Ratio)²)</code></pre>
        <p class="mt-2 text-sm text-gray-300">Apply weight effect quadratically with ratio clamped to minimum 0.95, then round to get final <strong class="text-white">Sheckles</strong>.</p>
    </div>
    
    <div class="mt-10 p-6 rounded-lg bg-yellow-100/10 border border-yellow-300/30">
        <h3 class="text-xl font-semibold text-yellow-300 mb-4">Parameters Explained</h3>
        <ul class="text-sm text-gray-300 space-y-2">
            <li><strong class="text-white">Base Price:</strong> The plant's unique base Sheckle value</li>
            <li><strong class="text-white">Weight:</strong> Actual plant weight in kg</li>
            <li><strong class="text-white">Base Weight:</strong> Standard weight for each plant type</li>
            <li><strong class="text-white">Variant Multiplier:</strong> Normal (×1), Silver (×5), Gold (×20), Rainbow (×50)</li>
            <li><strong class="text-white">Mutation Effects:</strong> Environmental mutations with additive value bonuses</li>
        </ul>
    </div>
</section>

<!-- FAQ Section -->
<div class="bg-gray-800 p-8 rounded-xl mx-auto max-w-6xl">
    <div class="text-center mb-8">
        <span class="inline-block px-3 py-1 text-xs bg-green-700 text-white rounded-full uppercase tracking-wider">FAQ</span>
        <h3 class="text-2xl font-bold mt-4 text-white">Frequently Asked Questions</h3>
    </div>
    <div class="space-y-6 text-gray-300 text-left">
        <div>
            <h4 class="font-semibold text-white">Is the calculator accurate?</h4>
            <p class="text-gray-400">
                <strong>Highly accurate!</strong> Based on exact game source code with 96-100% accuracy: 
                Perfect for high-value plants (500k+), within ±1-2 Sheckles for low-value plants. 
                Uses the same mathematical formulas as the game itself.
            </p>
        </div>
        <div>
            <h4 class="font-semibold text-white">Can I test different mutations?</h4>
            <p class="text-gray-400">Absolutely — just select a mutation and see how it changes your crop's value.</p>
        </div>
        <div>
            <h4 class="font-semibold text-white">Is this free to use?</h4>
            <p class="text-gray-400">Yes. No login or signup needed—just open and use it anytime.</p>
        </div>
        <div>
            <h4 class="font-semibold text-white">How do you keep crop values up-to-date?</h4>
            <p class="text-gray-400">We reference live data from the game files and update values regularly to reflect the latest changes.</p>
        </div>
    </div>
</div>
{% endblock %}
